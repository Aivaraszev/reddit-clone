@page "/"
@using System.Security.Claims
@inject NavigationManager NavMgr

<MudPaper Width="100%">
    <MudContainer Class="pa-5" MaxWidth="MaxWidth.Medium">
        <MudPaper Class="pa-5">
            <AuthorizeView>
                <Authorized>
                    <MudText Typo="Typo.h5" Class="pa-7 mud-theme-primary">Hello @_name</MudText>
                    <MudButton Class="mt-3" Variant="Variant.Filled" OnClick="CreatePost" Color="Color.Secondary">Create new post</MudButton>
                </Authorized>
                <NotAuthorized>
                    <MudText Typo="Typo.h5" Class="pa-7 mud-theme-primary">Log in to make posts.</MudText>
                </NotAuthorized>
            </AuthorizeView>
        </MudPaper>
        <ViewPosts></ViewPosts>
    </MudContainer>
</MudPaper>

@code
{
    [CascadingParameter]
    public Task<AuthenticationState> AuthState { get; set; } = null!;

    private string? _name;

    protected override async Task OnInitializedAsync()
    {
        AuthenticationState authState = await AuthState;
        ClaimsPrincipal user = authState.User;
        if (user.Identity == null) return;
        _name = user.Identity.Name;
    }

    private void CreatePost()
    {
        NavMgr.NavigateTo("/CreatePost");
    }
}